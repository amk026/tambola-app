<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes"
    />
    <title>üéØ TAMBOLA ¬∑ FULL HOUSIE</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/css/style.css" />
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  </head>
  <body>
    <div class="game-container" id="gameContainer">
      <!-- Tab Bar -->
      <div class="tab-bar" id="tabBar">
        <button id="mobilePlayerTab" class="tab active">üë• Player</button>
      </div>

      <!-- ===== HOST PANEL ===== -->
      <div id="hostPanel">
        <!-- Login Section -->
        <div id="loginSection">
          <div class="card">
            <div class="login-icon">üîê</div>
            <h2>Host Login</h2>
            <input
              type="text"
              id="username"
              placeholder="Username"
              autocomplete="off"
              value="admin"
            />
            <input
              type="password"
              id="password"
              placeholder="Password"
              value="myNewSecret"
            />
            <button id="loginBtn" class="btn btn-primary">Login</button>
            <button
              id="reconnectBtn"
              class="btn btn-secondary"
              style="margin-top: 10px"
            >
              üîÑ Reconnect
            </button>
            <div id="loginError" class="error" style="display: none"></div>
          </div>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboardSection" style="display: none">
          <!-- Title Row -->
          <div class="title-row">
            <h1>üéØ HOST</h1>
            <span id="statusBadge" class="status-badge">NO GAME</span>
          </div>

          <!-- Stats Cards -->
          <div class="stats-scroll">
            <div class="stat-card">
              <div class="stat-icon">üé´</div>
              <div class="stat-label">Total</div>
              <div class="stat-value" id="totalTickets">0</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">‚úÖ</div>
              <div class="stat-label">Booked</div>
              <div class="stat-value green" id="bookedTickets">0</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">‚ö°</div>
              <div class="stat-label">Available</div>
              <div class="stat-value blue" id="availableTickets">0</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">üèÜ</div>
              <div class="stat-label">Prizes</div>
              <div class="stat-value orange" id="winnersCount">0/5</div>
            </div>
          </div>

          <!-- WhatsApp Ranges Editor -->
          <div class="settings-panel">
            <h3
              style="
                display: flex;
                justify-content: space-between;
                align-items: center;
              "
            >
              üì≤ WhatsApp Ranges
              <span
                id="toggleWARangesBtn"
                style="cursor: pointer; font-size: 1.2rem; user-select: none"
                >‚ñº</span
              >
            </h3>
            <div id="waRangesContent" class="collapsible-content">
              <div id="waRangesList"></div>
              <button id="addRangeBtn" class="btn btn-secondary">
                + Add Range
              </button>
              <button id="saveWARangesBtn" class="btn btn-primary">
                Save All Ranges
              </button>
              <button
                id="testWARangesBtn"
                class="btn btn-secondary"
                style="margin-top: 10px"
              >
                üîç Test Ranges
              </button>
            </div>
          </div>

          <!-- Create Game -->
          <div class="settings-panel" id="createGameSection">
            <h3>üéÆ Create Game</h3>
            <input
              type="number"
              id="ticketCount"
              class="search-input"
              value="50"
              min="10"
              max="5000"
            />
            <button id="createGameBtn" class="btn btn-primary">
              CREATE GAME
            </button>
          </div>

          <!-- Game Control Panel -->
          <div
            class="settings-panel"
            id="gameControlPanel"
            style="display: none"
          >
            <h3
              style="
                display: flex;
                justify-content: space-between;
                align-items: center;
              "
            >
              üéÆ Game Control
              <span
                id="toggleGameControlBtn"
                style="cursor: pointer; font-size: 1.2rem; user-select: none"
                >‚ñº</span
              >
            </h3>
            <div id="gameControlContent" class="collapsible-content">
              <div
                id="sequenceInputContainer"
                style="margin-top: 16px; display: none"
              >
                <h4>üî¢ Draw Sequence</h4>
                <input
                  type="text"
                  id="customSequenceInput"
                  class="search-input"
                  placeholder="e.g. 45,12,78,23..."
                  value="5,12,23,34,45,56,67,78,89,90,1,2,3,4,6,7,8,9,10,11,13,14,15,16,17,18,19,20,21,22,24,25,26,27,28,29,30,31,32,33,35,36,37,38,39,40,41,42,43,44,46,47,48,49,50,51,52,53,54,55,57,58,59,60,61,62,63,64,65,66,68,69,70,71,72,73,74,75,76,77,79,80,81,82,83,84,85,86,87,88"
                />
                <button id="setSequenceBtn" class="btn btn-primary">
                  Set Sequence
                </button>
                <div id="sequenceError" class="error"></div>
              </div>

              <div class="game-control-card" id="gameControlCard">
                <div class="control-row">
                  <button id="startGameBtn" class="btn btn-success">
                    START
                  </button>
                  <button id="resetGameBtn" class="btn btn-danger">
                    RESET
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Countdown Display -->
          <div id="hostCountdownCard" class="countdown-card">
            <div>‚è≥ GAME STARTS IN</div>
            <div id="hostCountdownNumber" class="countdown-number">30</div>
          </div>

          <!-- Sticky Current Number -->
          <div
            id="hostCurrentNumberSticky"
            class="sticky-current-number"
            style="display: none"
          >
            <span>üé≤ Current:</span> <span id="hostCurrentNumberValue">--</span>
          </div>

          <!-- Called Numbers Grid -->
          <div class="called-wrapper">
            <div class="called-header">
              <h2>üî¢ Called</h2>
              <span id="calledCount">0/90</span>
            </div>
            <div id="calledNumbersGrid" class="number-grid"></div>
          </div>

          <!-- Winners Section -->
          <div
            class="winners-section"
            id="hostWinnersSection"
            style="display: none"
          >
            <div class="winners-header">
              <div><h2>üèÜ WINNERS</h2></div>
              <div class="winners-progress-container">
                <div
                  class="winners-progress-bar"
                  id="hostWinnersProgress"
                ></div>
              </div>
            </div>
            <div id="hostWinnersList" class="winners-list"></div>
          </div>

          <!-- Ticket Management -->
          <div class="ticket-management">
            <div class="ticket-toolbar" id="hostToolbar">
              <input
                type="text"
                id="hostSearchInput"
                class="search-input"
                placeholder="Search by ID or player name..."
              />
              <button id="generatePdfBtn" class="btn btn-secondary">
                üìÑ PDF
              </button>
            </div>
            <div id="ticketsGrid" class="ticket-grid"></div>
          </div>

          <!-- Logout -->
          <button
            id="logoutBtn"
            class="btn btn-danger"
            style="margin-top: 20px"
          >
            Logout
          </button>
        </div>
      </div>

      <!-- ===== PLAYER PANEL ===== -->
      <div id="playerPanel" style="display: none">
        <button id="backToHostBtn" class="back-to-host hidden">
          ‚Üê Back to Host
        </button>

        <div class="title-row">
          <h1>üéØ TAMBOLA</h1>
          <span id="playerStatusBadge" class="status-badge">NO GAME</span>
        </div>

        <div class="stats-scroll">
          <div class="stat-card">
            <div class="stat-icon">üé´</div>
            <div class="stat-label">Available</div>
            <div class="stat-value blue" id="playerAvailableTickets">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">üî¢</div>
            <div class="stat-label">Called</div>
            <div class="stat-value orange" id="playerCalledCount">0/90</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">üèÜ</div>
            <div class="stat-label">Prizes</div>
            <div class="stat-value" id="playerWinnersCount">0/5</div>
          </div>
        </div>

        <div id="playerCountdownCard" class="countdown-card">
          <div>‚è≥ GAME STARTS IN</div>
          <div id="playerCountdownNumber" class="countdown-number">30</div>
        </div>

        <div
          id="playerCurrentNumberSticky"
          class="sticky-current-number"
          style="display: none"
        >
          <span>üé≤ Current:</span> <span id="playerCurrentNumberValue">--</span>
        </div>

        <div class="called-wrapper">
          <div class="called-header">
            <h2>üî¢ Called</h2>
            <span id="playerCalledCountDisplay">0/90</span>
          </div>
          <div id="playerCalledNumbersGrid" class="number-grid"></div>
        </div>

        <div
          class="winners-section"
          id="playerWinnersSection"
          style="display: none"
        >
          <div class="winners-header">
            <div><h2>üèÜ WINNERS</h2></div>
            <div class="winners-progress-container">
              <div
                class="winners-progress-bar"
                id="playerWinnersProgress"
              ></div>
            </div>
          </div>
          <div id="playerWinnersList" class="winners-list"></div>
        </div>

        <div class="ticket-toolbar" id="playerSearchWrapper">
          <input
            type="text"
            id="playerSearchInput"
            class="search-input"
            placeholder="Search by ID or player name..."
            autocomplete="off"
          />
        </div>
        <div id="playerTicketsGrid" class="ticket-grid"></div>
        <div id="playerNoResults" class="no-results">No tickets found</div>
      </div>

      <!-- Modals (only those still needed) -->
      <div id="winnerModal" class="modal-overlay">
        <div class="modal-content">
          <span class="close">&times;</span>
          <h3 id="modalTitle">üèÜ WINNING TICKET</h3>
          <div id="modalWinnerInfo"></div>
          <div id="modalTicketGrid" class="modal-ticket-grid"></div>
          <div id="modalCalledList" class="called-list"></div>
        </div>
      </div>

      <div id="countdownModal" class="modal-overlay">
        <div class="modal-content">
          <h3>‚è±Ô∏è Set Countdown</h3>
          <input
            type="text"
            id="countdownInput"
            class="search-input"
            value="30"
          />
          <div class="quick-select">
            <button class="quick-select-btn" data-time="15">15s</button>
            <button class="quick-select-btn" data-time="30">30s</button>
            <button class="quick-select-btn" data-time="60">1m</button>
            <button class="quick-select-btn" data-time="120">2m</button>
            <button class="quick-select-btn" data-time="300">5m</button>
          </div>
          <div>
            <button id="cancelCountdownBtn" class="btn btn-danger">
              Cancel
            </button>
            <button id="confirmCountdownBtn" class="btn btn-success">
              Start Game
            </button>
          </div>
        </div>
      </div>

      <div id="ticketGridModal" class="modal-overlay">
        <div class="modal-content">
          <span class="close">&times;</span>
          <h3>üìã Ticket Grid</h3>
          <div id="ticketGridContainer" class="ticket-grid-container"></div>
          <div style="display: flex; gap: 10px; margin-top: 20px">
            <button id="cancelGridModalBtn" class="btn btn-danger">
              Cancel
            </button>
            <button id="printPdfBtn" class="btn btn-primary">Print PDF</button>
          </div>
        </div>
      </div>

      <div id="popupContainer" class="popup-container"></div>
    </div>

    <script src="/js/script.js"></script>
  </body>
</html>
